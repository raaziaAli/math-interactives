<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Learning DNA Inventory - Growing Tomorrow's Citizens</title>
<style>
  :root{
    --bg:#faf7ef; --card:#ffffff; --ink:#2e2e2e; --muted:#6b6b6b; --line:#e7e0cf;
    --gold:#f6d776; --gold2:#f3c64d; --ok:#168a44; --warn:#d48b07; --low:#d13535; --accent:#3a3a3a;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Ubuntu,Helvetica,Arial,sans-serif;color:var(--ink);background:var(--bg)}
  header{background:var(--accent);color:#fff;padding:16px 18px;text-align:center;border-bottom:3px solid var(--gold2)}
  header h1{margin:0;font-size:22px}
  header p{margin:6px 0 0 0;color:#e8e8e8}
  .wrap{max-width:1024px;margin:20px auto;padding:0 16px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:18px;margin:14px 0;box-shadow:0 8px 18px rgba(0,0,0,0.05)}
  h2{margin:0 0 10px 0}
  label{font-weight:600;font-size:14px;margin-bottom:6px;display:block}
  input[type="text"], input[type="password"], select, textarea{width:100%;padding:10px 12px;border:1px solid var(--line);border-radius:12px;background:#fff;font-size:14px}
  textarea{min-height:60px;resize:vertical}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  @media (max-width:900px){ .row{grid-template-columns:1fr} }
  .question{border:1px solid var(--line);border-radius:12px;padding:12px;margin:10px 0;background:#fff}
  .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
  button{padding:10px 14px;border-radius:12px;border:1px solid var(--line);cursor:pointer;font-weight:700}
  .primary{background:var(--gold2);color:#292929}
  .ghost{background:#fff;color:#2e2e2e}
  .hint{font-size:12px;color:var(--muted);margin-top:6px}
  table{width:100%;border-collapse:collapse;font-size:14px}
  th,td{padding:8px;border-bottom:1px solid var(--line);text-align:center}
  th{background:#fff3c2}
  .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
  @media (max-width:900px){ .grid{grid-template-columns:1fr 1fr} }
  .kpi{border:1px solid var(--line);border-radius:14px;padding:14px;background:#fff}
  .kpi .v{font-size:26px;font-weight:800}
  .kpi .l{font-size:12px;color:var(--muted)}
  .kpi.low{border-color:#f7c0c0}
  .kpi.warn{border-color:#ffe3a3}
  .kpi.ok{border-color:#bfe9cc}
  .badge{display:inline-block;padding:6px 10px;border-radius:999px;border:1px solid var(--line);background:#fff;margin:4px;font-size:12px}
  canvas{width:100%;height:260px;border:1px solid var(--line);border-radius:12px;background:#fff}
</style>
</head>
<body>
<header>
  <h1>Learning DNA Inventory - Growing Tomorrow's Citizens</h1>
  <p>Understanding learner strengths and next steps</p>
</header>

<div class="wrap">

  <section class="card" id="survey">
    <h2>Student Inventory</h2>
    <p class="hint">Rate each statement from 1 to 4 (1=rarely, 2=sometimes, 3=most often, 4=consistently). Add notes if you wish.</p>
    <label>Student Name (optional)
      <input id="name" type="text" placeholder="First name or initials">
    </label>
    <label>Class or Section (optional)
      <input id="clazz" type="text" placeholder="e.g., 7A, Algebra 1">
    </label>

    <div id="questions"></div>

    <div class="actions">
      <button class="primary" id="submit">Submit Response</button>
      <button class="ghost" id="clear">Clear</button>
      <button class="ghost" id="openDash">Open Teacher Dashboard</button>
    </div>
    <div class="hint">All responses are saved locally on this device only.</div>
  </section>

  <section class="card" id="dashboard" style="display:none">
    <h2>Teacher Dashboard</h2>
    <div id="gate">
      <label>Enter password to view dashboard
        <input id="pw" type="password" placeholder="Password (default: teacher)">
      </label>
      <div class="actions">
        <button class="primary" id="unlock">Unlock</button>
        <button class="ghost" id="closeDash">Close</button>
      </div>
      <div class="hint">Change the password by editing the PASSWORD constant in this file.</div>
    </div>

    <div id="dash" style="display:none">
      <div class="grid">
        <div class="kpi" id="k_total"><div class="v">0</div><div class="l">Total Responses</div></div>
        <div class="kpi" id="k_index"><div class="v">-</div><div class="l">Learning DNA Index (avg of all items)</div></div>
        <div class="kpi" id="k_strength"><div class="v">-</div><div class="l">Strongest Domain</div></div>
        <div class="kpi" id="k_growth"><div class="v">-</div><div class="l">Growth Domain</div></div>
      </div>

      <div class="card">
        <h3>Average Score by Domain (1 to 4)</h3>
        <canvas id="chart"></canvas>
      </div>

      <div class="card">
        <h3>Automatic Insights</h3>
        <div id="insights" class="hint">No data yet.</div>
      </div>

      <div class="card">
        <h3>Recent Submissions</h3>
        <table id="tbl">
          <thead>
            <tr><th>When</th><th>Name</th><th>Class</th><th>Curiosity</th><th>Self-Reg</th><th>Collab</th><th>Resilience</th><th>Reflection</th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <div class="actions">
        <button class="primary" id="refresh">Refresh</button>
        <button class="ghost" id="export">Export CSV</button>
        <button class="ghost" id="print">Print</button>
      </div>
    </div>
  </section>

</div>

<script>
// Password and storage key
const PASSWORD = "teacher";
const KEY = "dna_inventory_rows";

// Domains and items (editable). Each domain averages its items.
const DOMAINS = [
  { key:"curiosity",   label:"Curiosity",   items:[
      "I ask questions to understand ideas more deeply.",
      "I look for patterns and connections in what I learn."
    ]},
  { key:"selfreg",     label:"Self-Reg",    items:[
      "I plan my time and stick to routines that help me learn.",
      "I stay focused when working and manage distractions."
    ]},
  { key:"collab",      label:"Collaboration", items:[
      "I listen and build on others' ideas in group work.",
      "I do my fair share and help move the team forward."
    ]},
  { key:"resilience",  label:"Resilience",  items:[
      "I keep working when tasks are difficult.",
      "I try new strategies if my first attempt does not work."
    ]},
  { key:"reflection",  label:"Reflection",  items:[
      "I think about what worked and what I can improve next time.",
      "I use feedback to set a clear next step."
    ]}
];

// Helpers
const $ = s => document.querySelector(s);
const $$ = s => Array.from(document.querySelectorAll(s));
function esc(s){ return String(s||"").replace(/[&<>"]/g, m=>({"&":"&amp;","<":"&lt;",">":"&gt;"}[m])); }
function loadRows(){ return JSON.parse(localStorage.getItem(KEY) || "[]"); }
function saveRow(r){ const a=loadRows(); a.push(r); localStorage.setItem(KEY, JSON.stringify(a)); }
function avg(a){ return a.length ? a.reduce((x,y)=>x+y,0)/a.length : 0; }
function cls(v){ if(v<2.5) return "low"; if(v<3.2) return "warn"; return "ok"; }

// Render survey
function renderSurvey(){
  const q = $("#questions"); q.innerHTML = "";
  DOMAINS.forEach((d,di)=>{
    d.items.forEach((txt,ii)=>{
      const div = document.createElement("div"); div.className = "question";
      div.innerHTML = '<label>'+(di+1)+'.'+(ii+1)+' '+esc(d.label)+' - '+esc(txt)+'</label>' +
        '<div class="row">' +
          '<div><label>Score (1 to 4)</label>' +
          '<select id="score_'+d.key+'_'+ii+'">' +
          '<option value="">Select</option>' +
          '<option value="1">1 - rarely</option>' +
          '<option value="2">2 - sometimes</option>' +
          '<option value="3">3 - most often</option>' +
          '<option value="4">4 - consistently</option>' +
          '</select></div>' +
          '<div><label>Note (optional)</label>' +
          '<textarea id="note_'+d.key+'_'+ii+'" placeholder="Add a brief note if helpful..."></textarea></div>' +
        '</div>';
      q.appendChild(div);
    });
  });
}
renderSurvey();

// Form handlers
$("#submit").addEventListener("click", ()=>{
  const name = $("#name").value.trim();
  const clazz = $("#clazz").value.trim();
  const scores = {}; const notes = {};
  for(const d of DOMAINS){
    scores[d.key] = [];
    notes[d.key] = [];
    for(let i=0;i<d.items.length;i++){
      const v = parseInt($("#score_"+d.key+"_"+i).value,10);
      if(!(v>=1 && v<=4)){ alert("Please select a score 1-4 for every item."); return; }
      scores[d.key].push(v);
      notes[d.key].push($("#note_"+d.key+"_"+i).value.trim());
    }
  }
  saveRow({ ts: new Date().toISOString(), name, clazz, scores, notes });
  alert("Thanks for completing the Learning DNA Inventory!");
  clearForm();
});
$("#clear").addEventListener("click", clearForm);
function clearForm(){
  $("#name").value = ""; $("#clazz").value = "";
  DOMAINS.forEach(d=>{ for(let i=0;i<d.items.length;i++){ $("#score_"+d.key+"_"+i).value=""; $("#note_"+d.key+"_"+i).value=""; } });
}

// Dashboard open/close
$("#openDash").addEventListener("click", ()=>{
  $("#dashboard").style.display = "";
  $("#gate").style.display = "";
  $("#dash").style.display = "none";
  window.scrollTo({top:0,behavior:"smooth"});
});
$("#closeDash").addEventListener("click", ()=>{ $("#dashboard").style.display = "none"; });

// Unlock
$("#unlock").addEventListener("click", ()=>{
  if($("#pw").value.trim() === PASSWORD){
    $("#gate").style.display = "none";
    $("#dash").style.display = "";
    renderAll();
  }else{
    alert("Incorrect password.");
  }
});

// Analytics
function summarize(rows){
  const n = rows.length;
  const domainAvgs = {};
  DOMAINS.forEach(d=>{
    let sum=0, count=0;
    rows.forEach(r=>{
      (r.scores[d.key]||[]).forEach(v=>{ sum += Number(v||0); count++; });
    });
    domainAvgs[d.key] = count? (sum/count) : 0;
  });
  const index = avg(Object.values(domainAvgs));
  let lowKey=null, lowVal=Infinity, highKey=null, highVal=-Infinity;
  for(const k of Object.keys(domainAvgs)){
    const v = domainAvgs[k];
    if(v<lowVal){ lowVal=v; lowKey=k; }
    if(v>highVal){ highVal=v; highKey=k; }
  }
  return { n, domainAvgs, index, lowKey, lowVal, highKey, highVal };
}

function labelFor(k){ return (DOMAINS.find(d=>d.key===k)||{label:k}).label; }

function renderKPIs(s){
  $("#k_total .v").textContent = s.n;
  const idxBox = $("#k_index"); idxBox.querySelector(".v").textContent = s.n? s.index.toFixed(2) : "-";
  idxBox.className = "kpi "+(s.n? cls(s.index):"");
  const stBox = $("#k_strength"); stBox.querySelector(".v").textContent = s.n? (s.highKey? (labelFor(s.highKey)+" ("+s.highVal.toFixed(2)+")") : "-") : "-";
  const grBox = $("#k_growth"); grBox.querySelector(".v").textContent = s.n? (s.lowKey? (labelFor(s.lowKey)+" ("+s.lowVal.toFixed(2)+")") : "-") : "-";
  grBox.className = "kpi "+(s.n? cls(s.lowVal):"");
}

function renderChart(domainAvgs){
  const c = document.getElementById("chart");
  const ctx = c.getContext("2d");
  const w = c.width = c.clientWidth*2;
  const h = c.height = 260*2;
  const pad = 40;
  ctx.clearRect(0,0,w,h);
  // axes
  ctx.strokeStyle = "#e0d7bf"; ctx.lineWidth = 2;
  ctx.beginPath(); ctx.moveTo(pad,pad); ctx.lineTo(pad,h-pad); ctx.lineTo(w-pad,h-pad); ctx.stroke();
  // y scale 0..4
  for(let y=0;y<=4;y++){
    const yy = h - pad - (h-2*pad)*(y/4);
    ctx.fillStyle = "#6b6b6b"; ctx.font = "24px system-ui"; ctx.fillText(String(y), pad-24, yy+6);
    ctx.strokeStyle = "#f0e9d6"; ctx.beginPath(); ctx.moveTo(pad,yy); ctx.lineTo(w-pad,yy); ctx.stroke();
  }
  // bars
  const keys = Object.keys(domainAvgs);
  const bw = (w - 2*pad) / keys.length;
  keys.forEach((k,i)=>{
    const v = domainAvgs[k] || 0;
    const x = pad + i*bw + 6;
    const bh = (h - 2*pad) * (v/4);
    const y = h - pad - bh;
    let color = "#168a44"; if(v<2.5) color="#d13535"; else if(v<3.2) color="#d48b07";
    ctx.fillStyle = color;
    ctx.fillRect(x, y, bw-12, bh);
    ctx.fillStyle = "#2e2e2e"; ctx.font = "24px system-ui";
    ctx.fillText(labelFor(k), x+2, h - pad + 24);
    ctx.fillText(v.toFixed(2), x+2, y - 6);
  });
}

function renderRecent(rows){
  const tb = document.querySelector("#tbl tbody"); tb.innerHTML = "";
  rows.slice(-10).reverse().forEach(r=>{
    // compute domain averages for each submission
    const per = {};
    DOMAINS.forEach(d=>{
      per[d.key] = avg((r.scores[d.key]||[]).map(Number));
    });
    const tr = document.createElement("tr");
    tr.innerHTML = "<td>"+new Date(r.ts).toLocaleString()+"</td>"+
                   "<td>"+esc(r.name)+"</td>"+
                   "<td>"+esc(r.clazz)+"</td>"+
                   "<td>"+(per.curiosity||0).toFixed(2)+"</td>"+
                   "<td>"+(per.selfreg||0).toFixed(2)+"</td>"+
                   "<td>"+(per.collab||0).toFixed(2)+"</td>"+
                   "<td>"+(per.resilience||0).toFixed(2)+"</td>"+
                   "<td>"+(per.reflection||0).toFixed(2)+"</td>";
    tb.appendChild(tr);
  });
}

function renderInsights(s){
  const box = document.getElementById("insights");
  if(!s.n){ box.textContent = "No data yet."; return; }
  const out = [];
  if(s.index >= 3.2) out.push("Overall learning habits are strong. Maintain challenge with explicit reflection.");
  else if(s.index >= 2.5) out.push("Overall habits are moderate. Target lower domains for near-term gains.");
  else out.push("Overall habits are emerging. Establish clear routines for self-regulation and reflection.");
  if(s.highKey && s.lowKey && s.highKey !== s.lowKey){
    out.push("Leverage strengths in "+labelFor(s.highKey)+" to support growth in "+labelFor(s.lowKey)+".");
  }
  if(s.lowKey){
    out.push("Plan mini-lessons and exemplars for "+labelFor(s.lowKey)+". Model and practice strategies weekly.");
  }
  box.innerHTML = out.map(x=>'<span class="badge">'+esc(x)+'</span>').join(" ");
}

function renderAll(){
  const rows = loadRows();
  const s = summarize(rows);
  renderKPIs(s);
  renderChart(s.domainAvgs);
  renderRecent(rows);
  renderInsights(s);
}

// Buttons
document.getElementById("refresh").addEventListener("click", renderAll);
document.getElementById("print").addEventListener("click", ()=>window.print());
document.getElementById("export").addEventListener("click", ()=>{
  const rows = loadRows();
  if(!rows.length) return alert("No data to export.");
  const headers = ["ts","name","clazz"].concat(DOMAINS.map(d=>d.key));
  const lines = [headers.join(",")].concat(
    rows.map(r => {
      const per = {}; DOMAINS.forEach(d=> per[d.key] = avg((r.scores[d.key]||[]).map(Number)));
      return [r.ts,r.name||"",r.clazz||"",...DOMAINS.map(d=>per[d.key].toFixed(2))]
        .map(x => '"' + String(x).replace(/"/g,'""') + '"').join(",");
    })
  );
  const blob = new Blob([lines.join("\n")], {type:"text/csv"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "dna_inventory_responses.csv";
  a.click();
});

</script>
</body>
</html>
