<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Interactive Applet Solving Linear Equations Ñ v6</title>
<style>
  body{background:#0b1220;color:#e9eefb;font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial;margin:0}
  .wrap{max-width:1100px;margin:24px auto 64px;padding:0 16px}
  .card{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.08);border-radius:16px;padding:18px}
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .select,.text,.btn,details{border-radius:12px;border:1px solid rgba(255,255,255,0.12);background:#0e1730;color:#e9eefb;padding:10px 12px;font-size:14px}
  .btn{cursor:pointer}
  .equation{font-size:28px;text-align:center;margin:12px 0}
  .mini{font-size:12px;color:#a9b6d7}
  .status{margin-top:8px;color:#a9b6d7}
  .tag{display:inline-block;margin-left:8px;padding:4px 8px;border-radius:999px;background:#122047;border:1px solid #203063;color:#a9c6ff;font-size:12px}
  details>summary{list-style:none; cursor:pointer; user-select:none; font-weight:600}
  details>summary::-webkit-details-marker{display:none}
  .guide{line-height:1.5}
  .guide h3{margin:8px 0 4px; font-size:16px}
  .guide ul{padding-left:18px}
</style>
</head>
<body>
<div class="wrap">
  <h1>Interactive Applet - Solving Linear Equations</h1>
  <p class="mini">Fractions mode now <em>shows exact fractions</em> (e.g., 5/6) instead of decimals, and the applet doubles as a study guide below.</p>

  <div class="row" style="margin:10px 0 16px">
    <label for="difficulty" class="mini">Difficulty</label>
    <select id="difficulty" class="select">
      <option value="one">One-step</option>
      <option value="two" selected>Two-step</option>
      <option value="bothSides">Both sides</option>
      <option value="fractions">Fractions</option>
      <option value="decimals">Decimals</option>
    </select>
    <button id="btnNew" class="btn">New Equation</button>
    <span id="modeTag" class="tag">Two-step</span>
  </div>

  <div class="card">
    <div id="equation" class="equation"></div>
    <div id="status" class="status"></div>

    <div class="row" style="margin-top:10px">
      <select id="op" class="select">
        <option value="add">Add</option>
        <option value="sub">Subtract</option>
        <option value="mul">Multiply</option>
        <option value="div">Divide</option>
      </select>
      <input id="opVal" class="text" placeholder="value (e.g., 3, 7x, 3/4, -1/2x)" />
      <button id="btnApply" class="btn">Apply to both sides</button>
      <button id="btnReset" class="btn">Reset</button>
    </div>

    <div class="row" style="margin-top:12px">
      <input id="guess" class="text" placeholder="Try a solution for x (number)" />
      <button id="btnCheck" class="btn">Check by substitution</button>
      <button id="btnSolve" class="btn">Reveal solution</button>
    </div>
    <div id="checkMsg" class="status"></div>

    <div style="margin-top:12px">
      <div class="mini"><strong>Tips:</strong> Move constants with numbers; move variable terms with kx (e.g., -3x). Clear fractions (use LCD) or decimals (use ?10, ?100) first.</div>
    </div>

    <h3 class="mini" style="margin-top:16px">Progress</h3>
    <ol id="history" class="mini"></ol>
  </div>

  <details class="card guide" style="margin-top:16px">
    <summary>Study Guide: Solving Linear Equations</summary>
    <div class="guide" style="margin-top:8px">
      <h3>Core Goal</h3>
      <p>Isolate <strong>x</strong> while keeping the equation balanced. Any operation done to one side must be done to the other.</p>
      <h3>Properties of Equality (legal moves)</h3>
      <ul>
        <li>Add/Subtract the same <em>number</em> or <em>term</em> (like <code>7x</code>) to both sides.</li>
        <li>Multiply/Divide both sides by the same <em>nonzero</em> number.</li>
      </ul>
      <h3>Strategy</h3>
      <ol>
        <li><strong>Simplify</strong> each side (distribute, combine like terms).</li>
        <li><strong>Collect</strong> variable terms on one side and constants on the other (use Add/Subtract with <code>kx</code> or a number).</li>
        <li><strong>Scale</strong> to make the coefficient of <code>x</code> equal to 1 (Multiply/Divide by the coefficient).</li>
        <li><strong>Check</strong> by substitution.</li>
      </ol>
      <h3>Special Cases</h3>
      <ul>
        <li><em>Identity</em> (e.g., <code>6 = 6</code>): every real number is a solution.</li>
        <li><em>Contradiction</em> (e.g., <code>3 = 8</code>): no solution.</li>
      </ul>
      <h3>Clearing Fractions & Decimals</h3>
      <ul>
        <li>Fractions: multiply both sides by the <em>LCD</em> to clear denominators.</li>
        <li>Decimals: multiply both sides by <code>10, 100, 1000, ...</code> to shift place values.</li>
      </ul>
      <h3>Quick Example</h3>
      <p>Solve (1/2)x + 3/4 = 5: multiply both sides by 4 ? 2x + 3 = 20 ? subtract 3 ? 2x = 17 ? divide by 2 ? x = 17/2. Verify by substitution.</p>
    </div>
  </details>
</div>

<script>
(function(){
  // ------- Utilities -------
  function Expr(a,b){this.a=a;this.b=b}
  function cloneEq(eq){return {L:new Expr(eq.L.a,eq.L.b),R:new Expr(eq.R.a,eq.R.b)}}
  function tidy(n){if(Math.abs(n)<1e-12)return 0;return Number(n.toFixed(12))}
  function simplify(e){e.a=tidy(e.a);e.b=tidy(e.b);return e}

  // Fraction display (for Fractions mode)
  var FRACTION_DENOMS = [2,3,4,5,6,8,10,12];
  function nearestFraction(n){
    var sign = n<0?-1:1; n = Math.abs(n);
    var r = Math.round(n); if(Math.abs(n-r)<1e-10) return {num:sign*r, den:1};
    var best = null, bestErr = 1e9;
    for(var i=0;i<FRACTION_DENOMS.length;i++){
      var den = FRACTION_DENOMS[i];
      var num = Math.round(n*den);
      var val = num/den;
      var err = Math.abs(val - n);
      if(err < bestErr + 1e-12){ bestErr = err; best = {num:sign*num, den:den}; }
    }
    return best || {num:sign*r, den:1};
  }
  function asFractionString(n){
    var f = nearestFraction(n);
    if(f.den===1) return String(f.num);
    var s = (f.num<0?"-":"");
    var anum = Math.abs(f.num);
    return s + anum + "/" + f.den;
  }

  var currentMode = 'two';
  function displayNumber(n){
    if(currentMode==='fractions') return asFractionString(n);
    var r=Math.round(n); return Math.abs(n-r)<1e-10?String(r):String(n);
  }

  function exprPretty(e){
    var s='';
    if(e.a!==0){
      if(e.a===1) s+='x';
      else if(e.a===-1) s+='-x';
      else s+=displayNumber(e.a)+'x';
    }
    if(e.b!==0){
      if(s) s+=(e.b>0?' + ':' - ')+displayNumber(Math.abs(e.b));
      else s+=displayNumber(e.b);
    }
    return s||'0'
  }
  function eqToString(eq){return exprPretty(eq.L)+' = '+exprPretty(eq.R)}

  function solve(eq){
    var A=tidy(eq.L.a-eq.R.a); var B=tidy(eq.R.b-eq.L.b);
    if(A===0){ if(B===0) return {kind:'identity'}; return {kind:'none'}; }
    return {kind:'one', x: tidy(B/A)};
  }
  function isIdentity(eq){return eq.L.a===eq.R.a && eq.L.b===eq.R.b}
  function isContradiction(eq){return eq.L.a===eq.R.a && eq.L.b!==eq.R.b}

  function ri(min,max){return Math.floor(Math.random()*(max-min+1))+min}
  function sg(){return Math.random()<0.5?-1:1}

  // ---- STRICT GENERATORS PER MODE ----
  function genOne(){
    if(Math.random()<0.5){
      var b = sg()*ri(1,12);
      var xStar = sg()*ri(1,12);
      var c = xStar + b;
      return {L:new Expr(1,b), R:new Expr(0,c)};
    }else{
      var a = sg()*ri(2,9);
      var xStar2 = sg()*ri(1,12);
      var c2 = a*xStar2;
      return {L:new Expr(a,0), R:new Expr(0,c2)};
    }
  }
  function genTwo(){
    var a = sg()*ri(2,9);
    var b = sg()*ri(1,12);
    var xStar = sg()*ri(1,12);
    var c = a*xStar + b;
    return {L:new Expr(a,b), R:new Expr(0,c)};
  }
  function genBothSides(){
    var xStar = sg()*ri(1,9);
    var a = sg()*ri(1,8);
    var c = a; while(c===a){ c = a + sg()*ri(1,6); }
    var b = sg()*ri(-10,10);
    var d = a*xStar + b - c*xStar;
    return {L:new Expr(a,b), R:new Expr(c,d)};
  }
  function genFractions(){
    var base = genTwo();
    var den = [2,3,4,6,12][ri(0,4)];
    base.L.a/=den; base.L.b/=den; base.R.a/=den; base.R.b/=den;
    simplify(base.L); simplify(base.R);
    return base;
  }
  function genDecimals(){
    var base = genTwo();
    var k = [0.1, 0.01][ri(0,1)];
    base.L.a*=k; base.L.b*=k; base.R.a*=k; base.R.b*=k;
    simplify(base.L); simplify(base.R);
    return base;
  }
  function genByMode(m){
    if(m==='one') return genOne();
    if(m==='two') return genTwo();
    if(m==='bothSides') return genBothSides();
    if(m==='fractions') return genFractions();
    if(m==='decimals') return genDecimals();
    return genTwo();
  }

  // -------- Input parsing (supports 7x, -x, 3/4, -1/2x, 0.5, etc.) --------
  function parseFraction(str){
    if(!/^[+-]?\d+(?:\/\d+)?$/.test(str)) return null;
    if(str.indexOf('/')===-1) return Number(str);
    var parts = str.split('/');
    var num = Number(parts[0]); var den = Number(parts[1]);
    if(!isFinite(num) || !isFinite(den) || den===0) return null;
    return num/den;
  }
  function parseOperand(raw){
    if(!raw) return null;
    var s = String(raw).replace(/\s+/g,'').toLowerCase();
    if(s.endsWith('x')){
      var coefStr = s.slice(0,-1);
      if(coefStr===''||coefStr==='+') return {type:'var', coef:1};
      if(coefStr==='-') return {type:'var', coef:-1};
      var frac = parseFraction(coefStr);
      if(frac===null){ var v = Number(coefStr); if(!isFinite(v)) return null; return {type:'var', coef: tidy(v)}; }
      return {type:'var', coef: tidy(frac)};
    } else {
      var f = parseFraction(s);
      if(f===null){ var w = Number(s); if(!isFinite(w)) return null; return {type:'const', value: tidy(w)}; }
      return {type:'const', value: tidy(f)};
    }
  }

  // ------- State & rendering -------
  var eq=null, original=null, steps=[];
  var eqEl=document.getElementById('equation');
  var statusEl=document.getElementById('status');
  var historyEl=document.getElementById('history');
  var guessEl=document.getElementById('guess');
  var checkMsg=document.getElementById('checkMsg');
  var difficulty=document.getElementById('difficulty');
  var modeTag=document.getElementById('modeTag');

  function setFrom(newEq){ original=cloneEq(newEq); eq=cloneEq(newEq); steps=[]; render(); }
  function render(){ eqEl.textContent=eqToString(eq); if(isIdentity(eq)) statusEl.textContent='Identity: all real numbers'; else if(isContradiction(eq)) statusEl.textContent='No solution (contradiction)'; else statusEl.textContent='Apply an operation to both sides, then simplify.'; historyEl.innerHTML=steps.map(function(s,i){return '<li>Step '+(i+1)+': '+s+'</li>'}).join('') }

  function newEquation(){
    var mode=difficulty.value; currentMode = mode;
    modeTag.textContent = (
      mode==='one'?'One-step':
      mode==='two'?'Two-step':
      mode==='bothSides'?'Both sides':
      mode==='fractions'?'Fractions':'Decimals'
    );
    setFrom(genByMode(mode));
  }

  function applyOp(kind, operand){
    if(!operand) return;
    if((kind==='mul'||kind==='div') && operand.type==='var'){
      statusEl.textContent='Multiply/Divide must use a number, not kx.'; return;
    }
    if(kind==='add'){
      if(operand.type==='const'){
        eq.L.b=tidy(eq.L.b+operand.value); eq.R.b=tidy(eq.R.b+operand.value);
        steps.push('Add '+(currentMode==='fractions'?asFractionString(operand.value):operand.value)+' to both sides');
      } else {
        eq.L.a=tidy(eq.L.a+operand.coef); eq.R.a=tidy(eq.R.a+operand.coef);
        steps.push('Add '+(currentMode==='fractions'?asFractionString(operand.coef):operand.coef)+'x to both sides');
      }
    } else if(kind==='sub'){
      if(operand.type==='const'){
        eq.L.b=tidy(eq.L.b-operand.value); eq.R.b=tidy(eq.R.b-operand.value);
        steps.push('Subtract '+(currentMode==='fractions'?asFractionString(operand.value):operand.value)+' from both sides');
      } else {
        eq.L.a=tidy(eq.L.a-operand.coef); eq.R.a=tidy(eq.R.a-operand.coef);
        steps.push('Subtract '+(currentMode==='fractions'?asFractionString(operand.coef):operand.coef)+'x from both sides');
      }
    } else if(kind==='mul'){
      var v=operand.value; eq.L.a=tidy(eq.L.a*v); eq.L.b=tidy(eq.L.b*v); eq.R.a=tidy(eq.R.a*v); eq.R.b=tidy(eq.R.b*v);
      steps.push('Multiply both sides by '+(currentMode==='fractions'?asFractionString(v):v));
    } else if(kind==='div'){
      var v2=operand.value; if(v2===0){ statusEl.textContent='Cannot divide by 0.'; return; }
      eq.L.a=tidy(eq.L.a/v2); eq.L.b=tidy(eq.L.b/v2); eq.R.a=tidy(eq.R.a/v2); eq.R.b=tidy(eq.R.b/v2);
      steps.push('Divide both sides by '+(currentMode==='fractions'?asFractionString(v2):v2));
    }
    simplify(eq.L); simplify(eq.R);
    render();
    var S=solve(eq); if(S.kind==='one') statusEl.textContent='x = '+displayNumber(S.x);
  }

  document.getElementById('btnApply').addEventListener('click',function(){
    var kind=document.getElementById('op').value;
    var raw=document.getElementById('opVal').value;
    var operand=parseOperand(raw);
    if(!operand){ statusEl.textContent='Enter a number (e.g., 3 or 3/4) or a variable term (e.g., 7x, -1/2x).'; return; }
    applyOp(kind,operand);
  });
  document.getElementById('btnReset').addEventListener('click',function(){ eq=cloneEq(original); steps=[]; render(); });
  document.getElementById('btnSolve').addEventListener('click',function(){ var S=solve(eq); if(S.kind==='one'){ checkMsg.textContent='Solution: x = '+displayNumber(S.x); } else if(S.kind==='identity'){ checkMsg.textContent='Identity: all real numbers'; } else { checkMsg.textContent='No solution'; } });
  document.getElementById('btnCheck').addEventListener('click',function(){ var v=Number(guessEl.value); if(!isFinite(v)){ checkMsg.textContent='Enter a number to check.'; return; } var L=tidy(eq.L.a*v+eq.L.b); var R=tidy(eq.R.a*v+eq.R.b); if(Math.abs(L-R)<1e-9){ checkMsg.textContent='Works! LHS = RHS = '+displayNumber(L); } else { checkMsg.textContent='Not equal: LHS='+displayNumber(L)+', RHS='+displayNumber(R); } });
  document.getElementById('btnNew').addEventListener('click',newEquation);
  difficulty.addEventListener('change',newEquation);

  // init
  newEquation();
})();
</script>
</body>
</html>
